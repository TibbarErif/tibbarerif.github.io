<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="《名为怪物的游戏》序章 Demo（ver 0.3）"><meta name="keywords" content="最新进度"><meta name="author" content="火烧兔子"><meta name="copyright" content="火烧兔子"><title>《名为怪物的游戏》序章 Demo（ver 0.3） | 火兔游戏工作室</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.9.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  hexoVersion: '5.4.0'
} </script><meta name="generator" content="Hexo 5.4.0"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="切换文章详情">切换站点概览</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BA%8F%E7%AB%A0%E8%AF%B4%E6%98%8E"><span class="toc-number">1.</span> <span class="toc-text">序章说明</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Demo-%E4%B8%8B%E8%BD%BD"><span class="toc-number">2.</span> <span class="toc-text">Demo 下载</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#v0-3-1"><span class="toc-number">2.1.</span> <span class="toc-text">v0.3.1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#v0-3-0"><span class="toc-number">2.2.</span> <span class="toc-text">v0.3.0</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E8%AF%B4%E6%98%8E"><span class="toc-number">3.</span> <span class="toc-text">更新说明</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%8F%E6%B8%B8%E6%88%8F%E5%85%B3%E5%8D%A1"><span class="toc-number">3.1.</span> <span class="toc-text">小游戏关卡</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9C%BA%E6%99%AF%E7%B3%BB%E7%BB%9F"><span class="toc-number">3.2.</span> <span class="toc-text">场景系统</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%B9%E8%AF%9D%E7%B3%BB%E7%BB%9F"><span class="toc-number">3.3.</span> <span class="toc-text">对话系统</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8B%E4%BB%B6%E7%B3%BB%E7%BB%9F"><span class="toc-number">3.4.</span> <span class="toc-text">事件系统</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%90%8E%E7%BB%AD%E8%AE%A1%E5%88%92"><span class="toc-number">4.</span> <span class="toc-text">后续计划</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%B6%E4%BD%9C%E8%8A%B1%E7%B5%AE"><span class="toc-number">5.</span> <span class="toc-text">制作花絮</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0RPG%E6%B8%B8%E6%88%8F%E7%9A%84%E5%89%A7%E6%83%85%E6%96%87%E6%9C%AC%EF%BC%9F"><span class="toc-number">5.1.</span> <span class="toc-text">如何实现RPG游戏的剧情文本？</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%87%E4%BB%A4%E9%9B%86"><span class="toc-number">5.1.1.</span> <span class="toc-text">指令集</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4%E9%9B%86"><span class="toc-number">5.1.2.</span> <span class="toc-text">命令集</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E6%9C%AC%E9%9B%86"><span class="toc-number">5.1.3.</span> <span class="toc-text">文本集</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3%E6%8C%89%E9%94%AE%E9%97%AE%E9%A2%98%EF%BC%9F"><span class="toc-number">5.2.</span> <span class="toc-text">如何解决按键问题？</span></a></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="https://i.loli.net/2021/05/02/JjR7MmfePax3oc2.jpg"></div><div class="author-info__name text-center">火烧兔子</div><div class="author-info__description text-center">我的世界，在你手中。</div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">21</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">标签</span><span class="pull-right">7</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">分类</span><span class="pull-right">6</span></a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://i.loli.net/2021/05/02/61DLs9VHetxbq2n.jpg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">火兔游戏工作室</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">首页</a><a class="site-page" href="/categories">分类</a><a class="site-page" href="/tags">标签</a><a class="site-page" href="/archives">归档</a></span><span class="pull-right"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> 搜索</span></a></span></div><div id="post-info"><div id="post-title">《名为怪物的游戏》序章 Demo（ver 0.3）</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-06-22</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E5%90%8D%E4%B8%BA%E6%80%AA%E7%89%A9%E7%9A%84%E6%B8%B8%E6%88%8F/">名为怪物的游戏</a></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h1 id="序章说明"><a href="#序章说明" class="headerlink" title="序章说明"></a>序章说明</h1><p>本次更新衔接了之前的 FC 小游戏篇，进入到游戏的正式篇（序章部分）。<br>序章讲述了主角 Ace 与女主角瞳相遇，并且进入到「Monster」之前的故事。</p>
<h1 id="Demo-下载"><a href="#Demo-下载" class="headerlink" title="Demo 下载"></a>Demo 下载</h1><p>此处为演示版的下载，请优先选择最新版，即版本号比较高的下载。<br>如果测试过程遇到 BUG，请联系 QQ：874811226 反馈。</p>
<h2 id="v0-3-1"><a href="#v0-3-1" class="headerlink" title="v0.3.1"></a>v0.3.1</h2><p>6月26日更新。</p>
<p>Windows 版：<a target="_blank" rel="noopener" href="https://files.catbox.moe/sxmmeh.zip">点击下载</a><br>Mac 版：<a target="_blank" rel="noopener" href="https://files.catbox.moe/jxu9mc.zip">点击下载</a></p>
<p>更新说明：</p>
<ul>
<li>修复对话角标不动问题</li>
<li>减少部分调查事件对话内容</li>
<li>修复对话框可能在不同分辨率显示不全问题</li>
</ul>
<blockquote>
<p>经过测试 Windows 10 发现了对话卡死问题（非必现问题）如果遇到这种情况请联系 QQ：874811226 反馈。</p>
</blockquote>
<h2 id="v0-3-0"><a href="#v0-3-0" class="headerlink" title="v0.3.0"></a>v0.3.0</h2><p>本地下载：<a target="_blank" rel="noopener" href="https://files.catbox.moe/csz8hh.zip">点击下载</a><br>百度云：<a target="_blank" rel="noopener" href="https://pan.baidu.com/s/18ALimW9GmS8UXlqhpRdd_g">https://pan.baidu.com/s/18ALimW9GmS8UXlqhpRdd_g</a> 提取码：s5co</p>
<p>请下载最新版。</p>
<h1 id="更新说明"><a href="#更新说明" class="headerlink" title="更新说明"></a>更新说明</h1><p>目前的 Demo 版使用的素材均为临时素材，部分图片是草图甚至缺了一张 CG 用文字代替了。<br>因为正在赶进度，所以素材会比较潦草，不过到了正式发布的时候就会重新绘制。</p>
<p>小游戏从 cocos creator 移植到 unity 花了快一个月，接着制作序章基本是爆肝模式，从 6-11 开始，前两天其实就完成了，总的制作了差不多 10 天，从零开始构建了游戏的基本系统，然后测试加调整又花了两天，总的来说，<strong>这次的制作速度提高了不少</strong>。<br>其实也就不到十分钟的长度而已，游玩十分钟，制作花十天。</p>
<p><img src="https://files.catbox.moe/7vfb2i.jpg" alt="这是什么人间疾苦！"></p>
<h2 id="小游戏关卡"><a href="#小游戏关卡" class="headerlink" title="小游戏关卡"></a>小游戏关卡</h2><p>进入游戏会先进入小游戏关卡，根据玩家通关与否会触发不同的剧情对话。<br>其实小游戏跟正式篇没有什么必然的关系，只是用来纪念我和 Cee 小时候玩 FC 游戏的童年而已。</p>
<p><img src="https://files.catbox.moe/4fn2pv.jpg" alt="星之魔女小游戏"></p>
<h2 id="场景系统"><a href="#场景系统" class="headerlink" title="场景系统"></a>场景系统</h2><p>游戏的地图采用横版移动，在 RPG 游戏十分少见的类型。<br>因为这部新作本身就带有解谜要素，横版场景更适合「调查」，而且场景效果看起来也会比较好。<br>除此之外，采用横版地图还有一个考虑就是减少跑地图的时间，让玩家专注于剧情和玩法。</p>
<p><img src="https://files.catbox.moe/7i3z9r.jpg" alt="Ace房间场景"><br><img src="https://files.catbox.moe/4zwq9n.jpg" alt="客厅场景"><br><img src="https://files.catbox.moe/ltfw2m.jpg" alt="杂物间场景"></p>
<h2 id="对话系统"><a href="#对话系统" class="headerlink" title="对话系统"></a>对话系统</h2><p>带有人物立绘的对话系统。</p>
<p><img src="https://files.catbox.moe/p8n19l.png" alt="对话系统"></p>
<h2 id="事件系统"><a href="#事件系统" class="headerlink" title="事件系统"></a>事件系统</h2><p>在场景中按[Z]键即可进行调查，因为横版的关系可能会出现多个调查对象重叠在一起的情况，所以我临时做了一个选择调查对象的 UI。</p>
<p><img src="https://files.catbox.moe/c9puwh.jpg" alt="选择调查对象"></p>
<h1 id="后续计划"><a href="#后续计划" class="headerlink" title="后续计划"></a>后续计划</h1><p>序章还没有接触到游戏的核心玩法，要等到下次更新的「第一章」。<br>提前发布序章 Demo 主要还是为了让等了很久的群友先体验一下。<br>再不发布新作品，连我自己都怀疑我们到底有没有在做游戏了[○･｀Д´･ ○]<br>这次的更新也证明了我们是真的有在做游戏(～￣▽￣)～<br>之后也会在博客同步更新进度，建议还没入群的盆友加一下 QQ 群：84334403</p>
<p>因为写博客有点花时间，而且贴了代码感觉没什么人想看o(╥﹏╥)o<br>后面的博文就一切从简了，有时间的话，我会写制作花絮记录制作过程。</p>
<h1 id="制作花絮"><a href="#制作花絮" class="headerlink" title="制作花絮"></a>制作花絮</h1><p>这一部分是与游戏预告无关的，记录游戏制作过程的花絮（技术向）。<br>如果想要了解这部游戏是怎么做出来的盆友可以看看。</p>
<h2 id="如何实现RPG游戏的剧情文本？"><a href="#如何实现RPG游戏的剧情文本？" class="headerlink" title="如何实现RPG游戏的剧情文本？"></a>如何实现RPG游戏的剧情文本？</h2><p>众所周知，一部剧情向的游戏都有很长的剧情文本。<br>那么，剧情的文本到底是怎么写进游戏里面的？<br>看起来很简单的对话系统，其实要实现起来……也不难，但是难的如何将文字量庞大的语言用代码表达出来。</p>
<p>如果是文字量很小的游戏，可以用简单的代码控制：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Dialog.Show(&quot;小白&quot;, &quot;我是小白，本作的主人公。&quot;);</span><br></pre></td></tr></table></figure>

<p>只要提供一个对话方法：<code>Dialog.Show(string name, string content)</code> 调出对话框就行了。</p>
<p>其中 <code>name</code> 是人物名字，<code>content</code> 是对话内容。</p>
<p>按照上面的思路，写一段简单的对话可以用下面的形式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Dialog.Show(&quot;小白&quot;, &quot;可恶的魔王，快把公主放了！&quot;);</span><br><span class="line">Dialog.Show(&quot;魔王&quot;, &quot;哈哈哈！你就是勇者吗？&quot;);</span><br><span class="line">Dialog.Show(&quot;魔王&quot;, &quot;看起来弱的跟豆芽一样，想活命的话，就快点滚！&quot;);</span><br><span class="line">Dialog.Show(&quot;魔王&quot;, &quot;不过看你千辛万苦从新手村来到魔王城也不容易，本魔王就允许你带走一件宝贝。&quot;);</span><br><span class="line">Dialog.Show(&quot;小白&quot;, &quot;什么？这可是你说的！&quot;);</span><br><span class="line">Dialog.Show(&quot;魔王&quot;, &quot;当然，本魔王决不食言。&quot;);</span><br><span class="line">Dialog.Show(&quot;小白&quot;, &quot;那么，把公主给我吧！&quot;);</span><br><span class="line"></span><br><span class="line">Dialog.Show(&quot;旁白&quot;, &quot;勇者小白孤身前往魔王城救出公主，他的英勇事迹最终被写入史书中。&quot;);</span><br></pre></td></tr></table></figure>

<p>但如果是长篇且文字很多的游戏，这种方法就行不通了。<br>像 GalGame 动则百万字，这样写怕不是要累死程序员。</p>
<p>而且把剧情文本写在代码里，不仅工作量大，也不利于本地化（多语言）。</p>
<h3 id="指令集"><a href="#指令集" class="headerlink" title="指令集"></a>指令集</h3><p>在用 cocos creator 制作的时候，我采用的是十分常见的数据存储类型：JSON。</p>
<p>第一个文件用来保存文本：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;1&quot;: &quot;现在进行基本操作的说明，方向键可以控制角色移动，空格键为确认键。&quot;,</span><br><span class="line">    &quot;2&quot;: &quot;另外，在场景或人物前面按下空格键可以进行调查，请大胆的进行探索吧。&quot;,</span><br><span class="line">    &quot;3&quot;: &quot;有关「线索」的说明。&quot;,</span><br><span class="line">    &quot;4&quot;: &quot;线索是你对于这个世界已掌握的情报，可以在菜单「情报」随时查看。&quot;,</span><br><span class="line">    &quot;5&quot;: &quot;调查场景有时能发现新的线索，得到的线索越多就越接近这个世界的真相。&quot;,    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第二个文件用来保存文本调用及对应的指令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&quot;test&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;type&quot;: &quot;investigate&quot;,</span><br><span class="line">        &quot;role&quot;: &quot;story&quot;,</span><br><span class="line">        &quot;message&quot;: [</span><br><span class="line">            &quot;118&quot;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;type&quot;: &quot;img-show&quot;,</span><br><span class="line">        &quot;src&quot;: &quot;email4&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;type&quot;: &quot;investigate&quot;,</span><br><span class="line">        &quot;role&quot;: &quot;story&quot;,</span><br><span class="line">        &quot;message&quot;: [</span><br><span class="line">            &quot;119&quot;, &quot;120&quot;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;type&quot;: &quot;img-hidden&quot;,</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>通过第二个 JSON（指令集）来调用第一个对话中对应的文本，<code>type</code> 字段定义了不同的指令，例如显示普通的对话或者显示/隐藏图片。<br>这样虽然实现了剧情对话系统，但是工作量却异常恐怖，而且调试起来非常麻烦，因为对话文本都是用数字编号的形式，所以光看指令集根本看不懂对话内容是什么。</p>
<p>这种方式我叫它「指令集」的对话系统，因为不实用所以舍弃了。</p>
<h3 id="命令集"><a href="#命令集" class="headerlink" title="命令集"></a>命令集</h3><p>指令集的缺点是无法看懂对话内容，那只要让对话连在一起就行了。<br>所以第二版的对话系统，我采用了 Excel 表格的方式进行配置。</p>
<p><img src="https://files.catbox.moe/d726wh.jpg" alt="excel配置剧情对话"></p>
<p>用 excel 配置其实就是把指令集变成可视化的而已，看起来更直观。<br>上面所示的就是对话的配置，<code>role</code> 即角色名称，<code>avatar</code> 即显示的头像，<code>action</code> 可以增加一些特殊的事件，比如显示图片之类的，然后是 <code>zh-cn</code> 是简体中文对应的语言，<code>zh-tw</code> 就是繁体中文的文本，其他语言填写在对应的格子即可。</p>
<p>接着，还需要再新增一个 sheet 用来保存对话的指令：</p>
<p><img src="https://files.catbox.moe/0zuafn.jpg" alt="命令集合"></p>
<p>在指令里调用对话的 ID，这里我写了一个可以自动简化输入的符号 <code>~</code>，意思是从 x 到 n 之间连续的数字。<br>比如 <code>1~3</code>，就会自动生成：<code>c_00001</code>、<code>c_00003</code>、<code>c_00003</code> 这三条对话指令。<br>因为是把命令整合在一起，所以叫它「命令集」。<br>这套系统解决了无法看到对话内容的问题，而且也大大减少了输入指令的工作量。</p>
<p>但麻烦的是要填充剧情对话的表格，这套对话系统还采用了双边立绘，填充剧情对话表格的工作量直接翻倍了。<br>而且这套系统的对话全部保存在一个 excel 表格里，后期文本量巨大，全部加载到内存占用空间。<br>所以「命令集」式的对话，也被弃用了。</p>
<h3 id="文本集"><a href="#文本集" class="headerlink" title="文本集"></a>文本集</h3><p>既要解决可视化问题，又按需调用节省内存，就需要再次改进原系统。</p>
<p>最终版是我在制作「梦兽的世界」（宝可梦同人）时想到的。<br>由于宝可梦游戏的对话系统很简单，没有头像，只是单纯的文本。</p>
<p><img src="https://files.catbox.moe/q3y7yh.jpg" alt="宝可梦游戏的对话系统"></p>
<p>所以最开始我是以简单文本（txt）形式保存剧情对话的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">？？？：欢迎来到死后的世界。</span><br><span class="line">？？？：还记得以前的事情吗？</span><br><span class="line">？？？：你为了保护在路边睡觉的猫，结果被一辆大货车撞到了。</span><br><span class="line">？？？：那只猫就是我。</span><br></pre></td></tr></table></figure>

<p>左边是角色名称，右边是对话内容，十分简洁。<br>然后对话的文本单独存放，每一段剧情对话都新建一个 TXT 保存：</p>
<p><img src="https://files.catbox.moe/e1ksjb.jpg" alt="文本集"></p>
<p>当玩家与 NPC 对话的时候，根据需要取加载对应的本地文件，对话结束就释放内存节省空间。<br>这种方法我叫它「文本集」，就是新建许多文本的集合。<br>但是怪物游戏的对话系统可比这个复杂多了，所以我对这套系统进行了一些改进。<br>改进之后的文本变成了如下形式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#xiaoxing,normal</span><br><span class="line">为什么我就打不过！</span><br><span class="line"></span><br><span class="line">#xiaoxing,smile</span><br><span class="line">我要再玩一次。</span><br></pre></td></tr></table></figure>

<p>井号开头的就是一条指令，左边是名字，右边是对应的立绘。<br>这样就实现了怪物游戏的对话系统。</p>
<p>但是新的问题又来了，剧情对话不仅仅只是显示文本而已，中间如果要显示图片呢？如果要停顿 1s 呢？<br>在还没改进这套系统之前，我是这样实现剧情的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">private void SelectGame()</span><br><span class="line">&#123;</span><br><span class="line">    WindowManager.ShowImage(&quot;computer_1&quot;);</span><br><span class="line"></span><br><span class="line">    MapManager.FadeIn(&quot;black&quot;, 1f, 1f, delegate</span><br><span class="line">    &#123;</span><br><span class="line">        WindowManager.CallDialog(&quot;01_ace_room&#x2F;08_night&quot;, APP);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">private void APP()</span><br><span class="line">&#123;</span><br><span class="line">    WindowManager.HideImage();</span><br><span class="line">    WindowManager.ShowImage(&quot;computer_2&quot;);</span><br><span class="line"></span><br><span class="line">    WaitEvent(delegate</span><br><span class="line">    &#123;</span><br><span class="line">        WindowManager.CallDialog(&quot;01_ace_room&#x2F;09_app&quot;, PowerFailure);</span><br><span class="line">    &#125;, 1.5f);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">private void PowerFailure()</span><br><span class="line">&#123;</span><br><span class="line">    WindowManager.HideImage();</span><br><span class="line">    MapManager.FadeOut(&quot;black&quot;, 0.5f, 1f, delegate</span><br><span class="line">    &#123;</span><br><span class="line">        WindowManager.CallDialog(&quot;01_ace_room&#x2F;10_power_failure&quot;, delegate</span><br><span class="line">        &#123;</span><br><span class="line">            MapManager.GoToMap(&quot;01_AceRoomChange&quot;, -2.8f, -0.8f, 1);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>不仅要手动控制屏幕的淡入淡出、显示图片，而且这种无限嵌套的地狱也十分令人绝望。<br>改进之后，将这些特殊的指令也融入到文本里，最后就变成了这样：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">#none</span><br><span class="line">突然，脑海中浮现了一个画面……</span><br><span class="line"></span><br><span class="line">#img-show,memory_recover</span><br><span class="line">#wait,2</span><br><span class="line"></span><br><span class="line">#ace,normal</span><br><span class="line">这是小幸还有瞳……</span><br><span class="line"></span><br><span class="line">#ace,normal</span><br><span class="line">记忆好像……在一点点恢复……（头痛的感觉）</span><br><span class="line"></span><br><span class="line">#img-hide</span><br><span class="line"></span><br><span class="line">#ace,normal</span><br><span class="line">果然猜的没错，我们是认识的，这样的话，最后的证据也有了。</span><br><span class="line"></span><br><span class="line">#ace,normal</span><br><span class="line">这一连串发生的怪事……我终于知道了。</span><br><span class="line"></span><br><span class="line">#ace,normal</span><br><span class="line">所有的谜题全部解开了！</span><br></pre></td></tr></table></figure>

<p>井号开头的部分会被系统自动识别，不同的指令解析成对应的脚本执行。如此一来就不需要再手写代码控制显示图片和淡入淡出等操作了。<br>这套系统到最后的文本文件数量会非常多，不过这个缺点可以直接忽略就是了，因为文本文件基本不需要改动。</p>
<p>目前想到的最好方法就是文本集，但这样控制剧情还是避免不了要用代码，比如控制场景中的角色移动，如果能做到更完美的话，应该是不写一句代码就能控制整个游戏场景，很遗憾目前还不能做到完美，等到以后技术不断提高的时候就有可能实现了。就像最早的指令集到命令集，最后再到文本集的演变一样。</p>
<h2 id="如何解决按键问题？"><a href="#如何解决按键问题？" class="headerlink" title="如何解决按键问题？"></a>如何解决按键问题？</h2><p>这里的按键问题指的是「并行的按键问题」。<br>场景中有很多东西在监听玩家的按键，比如按「Z」键可以调查，按「X」键可以打开菜单，按「方向键」可以控制角色在场景中移动。<br>这么多监听事件，就会存在并行监听的情况。<br>比如玩家与地图上的 NPC 对话，此时玩家再按「Z」键会怎样呢？<br>① 角色在地图上可以按[Z]来调查<br>② 在对话中，玩家按[Z]键会切换到下一句对话<br>注意，这两个按键是同时监听的，也就是说，玩家想要按[Z]键切换下一句对话的时候，同时也会触发场景调查的[Z]键监听，结果就是对话切换到下一句，而且又触发了调查事件。<br>为了解决并行按键同时执行的问题，就需要确定事件的执行优先级。<br>当打开新窗口的时候，按键的监听权应该转交给最高级的那个窗口。<br>比如上面的例子，在没与 NPC 对话之前，[Z]键是监听调查事件的；<br>而在于 NPC 对话的时候，新建了一个对话窗口，此时应该把监听权交给对话窗口。<br>可以用数据结构里的「栈」来实现这种对话系统。<br>当一个新窗口被创建时，原来的监听对象就被压入栈，在压入栈之前还要解除对象的事件监听。<br>当一个新窗口被关闭时，就从栈弹出这个窗口的对象，把这个窗口删掉，同时继续弹出下一个对象，将操作权限赋予这个对象，再压回栈里。</p>
<p>最后，回到开头的那句话 <strong>游玩十分钟，制作却要花十天。</strong><br>虽然看起来很简单的事情，但是要实现起来可真不容易呀！！！</p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">火烧兔子</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://huotuyouxi.com/2021/06/22/monster-game-prologue/">http://huotuyouxi.com/2021/06/22/monster-game-prologue/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://huotuyouxi.com">火兔游戏工作室</a>！</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E6%9C%80%E6%96%B0%E8%BF%9B%E5%BA%A6/">最新进度</a></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2021/06/24/monster-game-version-100/"><i class="fa fa-chevron-left">  </i><span>《名为怪物的游戏》ver1.0.0（前半部分）</span></a></div><div class="next-post pull-right"><a href="/2021/06/11/monster-game-11/"><span>名为怪物的游戏（十一）正式篇开始制作 / 6月更新计划</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer class="footer-bg" style="background-image: url(https://i.loli.net/2021/05/02/61DLs9VHetxbq2n.jpg)"><div class="layout" id="footer"><div class="copyright">&copy;2020 - 2021 By 火烧兔子</div><div class="framework-info"><span>驱动 - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.0"></script><script src="/js/fancybox.js?version=1.9.0"></script><script src="/js/sidebar.js?version=1.9.0"></script><script src="/js/copy.js?version=1.9.0"></script><script src="/js/fireworks.js?version=1.9.0"></script><script src="/js/transition.js?version=1.9.0"></script><script src="/js/scroll.js?version=1.9.0"></script><script src="/js/head.js?version=1.9.0"></script><script src="/js/search/local-search.js"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a target="_blank" rel="noopener" href="https://github.com/wzpan/hexo-generator-search" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>